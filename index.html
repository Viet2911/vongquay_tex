<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÃ²ng Quay May Máº¯n - TEX EDU</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #fbe10e 0%, #f9d003 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 1.6em;
        }

        .form-group {
            margin-bottom: 12px;
            text-align: left;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
        }

        input:focus {
            border-color: #fbe10e;
        }

        .wheel-section {
            display: none;
            position: relative;
        }

        .wheel-wrapper {
            position: relative;
            width: 340px;
            height: 340px;
            margin: 0 auto 20px;
        }

        #wheel-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
            transition: transform 5s cubic-bezier(0.1, 0.7, 0.1, 1);
        }

        .arrow {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #ff4757;
            z-index: 10;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
        }

        .center-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            color: #d4af37;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #fbe10e;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 17px;
            cursor: pointer;
            box-shadow: 0 4px 0 #d4af37;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #d4af37;
        }

        .btn:disabled {
            background: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            background: #fffde7;
            border-radius: 10px;
            display: none;
            border: 2px dashed #f9d003;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ðŸŽ¡ VÃ²ng Quay May Máº¯n</h1>

        <div id="formSection">
            <div class="form-group"><input type="text" id="name" placeholder="Há» vÃ  tÃªn"></div>
            <div class="form-group"><input type="tel" id="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i"></div>
            <div class="form-group"><input type="email" id="email" placeholder="Email"></div>
            <button class="btn" onclick="submitForm()">TIáº¾P Tá»¤C</button>
        </div>

        <div id="wheelSection" class="wheel-section">
            <div class="wheel-wrapper">
                <div class="arrow"></div>
                <div class="center-dot">TEX</div>
                <svg id="wheel-svg" viewBox="0 0 100 100"></svg>
            </div>
            <button class="btn" id="spinBtn" onclick="spin()">QUAY NGAY</button>
            <div id="result" class="result">
                <p>ðŸŽ‰ ChÃºc má»«ng báº¡n Ä‘Ã£ trÃºng:</p>
                <strong id="prizeText" style="font-size: 1.3em; color: #e67e22;"></strong>
            </div>
        </div>
    </div>

    <script>
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyw7TtqqXY5lKk7TAeDPiQVtf5B1SJDICkEA_GA5sCZngxeHwRrMI_LelUfEi0knvzkag/exec';

        const prizes = [
            { text: '30h há»c GVNN', color: '#FF6B6B' },
            { text: 'Balo Tex Edu', color: '#FFA500' },
            { text: 'Vá»Ÿ Tex Edu', color: '#FFD93D' },
            { text: '20h Ngá»¯ PhÃ¡p', color: '#6BCF7F' },
            { text: 'Lá»‹ch Tex Edu', color: '#4ECDC4' },
            { text: 'GÃ³i 799k/thÃ¡ng', color: '#95E1D3' },
            { text: 'GiÃ¡o trÃ¬nh Cambrige + 1 thÃ¡ng há»c bá»•ng 100% GVNN', color: '#A29BFE' }, // Chuá»—i ráº¥t dÃ i
            { text: 'Há»c bá»•ng Tex', color: '#FD79A8' }
        ];

        let userData = {};
        let isSpinning = false;

        // HÃ m xá»­ lÃ½ cáº¯t chá»¯ thÃ´ng minh
        function truncateText(text, maxLength) {
            if (text.length > maxLength) {
                return text.substring(0, maxLength - 3) + "...";
            }
            return text;
        }

        function drawWheel() {
            const svg = document.getElementById('wheel-svg');
            const numPrizes = prizes.length;
            const angleStep = 360 / numPrizes;

            prizes.forEach((prize, i) => {
                const startAngle = i * angleStep;
                const endAngle = (i + 1) * angleStep;

                // 1. Váº½ nan quáº¡t
                const x1 = 50 + 50 * Math.cos(Math.PI * startAngle / 180);
                const y1 = 50 + 50 * Math.sin(Math.PI * startAngle / 180);
                const x2 = 50 + 50 * Math.cos(Math.PI * endAngle / 180);
                const y2 = 50 + 50 * Math.sin(Math.PI * endAngle / 180);

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", `M 50 50 L ${x1} ${y1} A 50 50 0 0 1 ${x2} ${y2} Z`);
                path.setAttribute("fill", prize.color);
                path.setAttribute("stroke", "#ffffff");
                path.setAttribute("stroke-width", "0.4");
                svg.appendChild(path);

                // 2. Váº½ chá»¯ vá»›i Padding 10px (tÆ°Æ¡ng á»©ng khoáº£ng 10 Ä‘Æ¡n vá»‹ trong viewBox 100)
                const textAngle = startAngle + angleStep / 2;

                // BÃ¡n kÃ­nh chá»¯ lÃ  35 (cÃ¡ch tÃ¢m 35 Ä‘Æ¡n vá»‹, cÃ¡ch rÃ¬a 15 Ä‘Æ¡n vá»‹ - Ä‘Ã³ng vai trÃ² padding rÃ¬a)
                const textX = 50 + 32 * Math.cos(Math.PI * textAngle / 180);
                const textY = 50 + 32 * Math.sin(Math.PI * textAngle / 180);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", textX);
                text.setAttribute("y", textY);
                text.setAttribute("fill", "white");
                text.setAttribute("font-size", "2.8"); // Size chá»¯ nhá» Ä‘á»ƒ vá»«a Ã´ 8
                text.setAttribute("font-weight", "bold");
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("transform", `rotate(${textAngle + 90}, ${textX}, ${textY})`);

                // Giá»›i háº¡n khoáº£ng 18-20 kÃ½ tá»± cho nan quáº¡t 8 Ã´ Ä‘á»ƒ khÃ´ng cháº¡m rÃ¬a
                text.textContent = truncateText(prize.text, 18);

                svg.appendChild(text);
            });
        }

        function submitForm() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();

            if (!name || !phone || !email) return alert("Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin!");
            if (localStorage.getItem('spun_' + email)) return alert("Email nÃ y Ä‘Ã£ tham gia!");

            userData = { name, phone, email };
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('wheelSection').style.display = 'block';
        }

        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;

            const wheelSvg = document.getElementById('wheel-svg');
            const randomDeg = Math.floor(Math.random() * 360);
            const totalDeg = 3600 + randomDeg;

            wheelSvg.style.transform = `rotate(${totalDeg - 90}deg)`;

            setTimeout(() => {
                const actualDeg = totalDeg % 360;
                const angleStep = 360 / prizes.length;
                const prizeIndex = Math.floor((360 - actualDeg) / angleStep) % prizes.length;
                const winner = prizes[prizeIndex];

                document.getElementById('prizeText').innerText = winner.text;
                document.getElementById('result').style.display = 'block';

                saveToSheet(winner.text);
                localStorage.setItem('spun_' + userData.email, true);
            }, 5000);
        }

        async function saveToSheet(prizeName) {
            const data = { ...userData, prize: prizeName, time: new Date().toLocaleString() };
            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
            } catch (e) { console.log("Lá»—i gá»­i dá»¯ liá»‡u"); }
        }

        drawWheel();
    </script>
</body>

</html>
